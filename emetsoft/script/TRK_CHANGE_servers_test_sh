
KILL_passet_test_sh

CURR=COP
ISSUER=passet_issuer 
SELECTOR=passet_choose 
TRANSFER=passet_transfer 
PROTO=-mudp
# PROTO=-tcp

cd /home/jose/tmp
rm -rf passet_test
mkdir passet_test

cd ./passet_test

GAM_FF=../gamal_sys_0.dat

PORT_S=8765
PORT_T1=5433

DOM_S=localhost:$PORT_S:7000

PORT_1=9101
PORT_2=9102
PORT_3=9103
PORT_4=9104

$ISSUER -k "supr" $PROTO -c -snm "nm_supr" -sid "id_sup" -scc "CO" -glid -gamal $GAM_FF
$ISSUER -k "trk1" $PROTO -c -snm "nm_trk1" -sid "id_tk1" -scc "CO" -glid -gamal $GAM_FF

$ISSUER -k "usu1" $PROTO -c -snm "nm_usu1" -sid "id_001" -scc "CO" -glid -gamal $GAM_FF
$ISSUER -k "usu2" $PROTO -c -snm "nm_usu2" -sid "id_002" -scc "CO" -glid -gamal $GAM_FF
$ISSUER -k "usu3" $PROTO -c -snm "nm_usu3" -sid "id_003" -scc "CO" -glid -gamal $GAM_FF
$ISSUER -k "usu4" $PROTO -c -snm "nm_usu4" -sid "id_004" -scc "CO" -glid -gamal $GAM_FF

echo "INITED_ACCOUNTS"

GLI_SUPRA=`$ISSUER -k "supra" $PROTO -prt_glid`
GLI_T1=`$ISSUER -k "trk1" $PROTO -prt_glid`

GLI_1=`$ISSUER -k "usu1" $PROTO -prt_glid`

echo "GLI_T1="$GLI_T1
echo "GLI_1="$GLI_1

echo "INITED_GLID_VARS"

$TRANSFER -k "supr" $PROTO -port "$PORT_S" -is_supra &

$TRANSFER -k "trk1" $PROTO -port "$PORT_T1" -add_supra "$DOM_S"

$TRANSFER -k "usu1" $PROTO -port "$PORT_1" -add_supra "$DOM_S"
$TRANSFER -k "usu2" $PROTO -port "$PORT_2" -add_supra "$DOM_S"
$TRANSFER -k "usu3" $PROTO -port "$PORT_3" -add_supra "$DOM_S"
$TRANSFER -k "usu4" $PROTO -port "$PORT_4" -add_supra "$DOM_S"

echo "ADDED_ALL_SUPRAS"

$ISSUER -k usu1 $PROTO -tat $GLI_1
$ISSUER -k usu2 $PROTO -tat $GLI_1
$ISSUER -k usu3 $PROTO -tat $GLI_1
$ISSUER -k usu4 $PROTO -tat $GLI_1
$ISSUER -k trk1 $PROTO -tat $GLI_1

echo "ALL_TRUST_USU1"

$TRANSFER -k "trk1" $PROTO -port "$PORT_T1" &

echo "STARTED_TRACKERS"

$ISSUER -k usu1 $PROTO -s -n 5z3 -m $CURR 
$ISSUER -k usu2 $PROTO -s -n 5z3 -m $CURR 
$ISSUER -k usu3 $PROTO -s -n 5z3 -m $CURR 
$ISSUER -k usu4 $PROTO -s -n 5z3 -m $CURR 

echo "ALL_CURR="$CURR

$ISSUER -k usu1 $PROTO -ISSUE 1

echo "ISSUED_ROOT"

$ISSUER -k usu1 $PROTO -set_next_tracker $GLI_T1

echo "CHANGED_NEXT_TRACKER"

$TRANSFER -k usu1 $PROTO -chann -port "$PORT_1" -r $GLI_T1

echo "UPDATED_TRACKER"


$TRANSFER -k "usu1" $PROTO -port "$PORT_1" &
$TRANSFER -k "usu2" $PROTO -port "$PORT_2" &
$TRANSFER -k "usu3" $PROTO -port "$PORT_3" &
$TRANSFER -k "usu4" $PROTO -port "$PORT_4" &

echo "USERS_STARTED"
