
KILL_passet_test_sh

CURR=COP
ISSUER=passet_issuer 
SELECTOR=passet_choose 
TRANSFER=passet_transfer 
PROTO=-mudp
# PROTO=""

cd /home/jose/tmp
rm -rf passet_test
mkdir passet_test

cd ./passet_test

GAM_FF=../gamal_sys_0.dat

PORT_S1=5432
PORT_T1=5433
PORT_T2=5434
PORT_U1=9101
PORT_U2=9102

DOM_S=localhost:$PORT_S1:7000

$ISSUER -k "supra" $PROTO -c -snm "nm_supra" -sid "id_supra" -scc "CO" -glid -gamal $GAM_FF
$ISSUER -k "usu1" $PROTO -c -snm "nm_usu1" -sid "id_usu1" -scc "CO" -glid -gamal $GAM_FF
$ISSUER -k "usu2" $PROTO -c -snm "nm_usu2" -sid "id_usu2" -scc "CO" -glid -gamal $GAM_FF
$ISSUER -k "trk1" $PROTO -c -snm "nm_trk1" -sid "id_trk1" -scc "CO" -glid -gamal $GAM_FF
$ISSUER -k "trk2" $PROTO -c -snm "nm_trk2" -sid "id_trk2" -scc "CO" -glid -gamal $GAM_FF

GLI_U1=`$ISSUER -k "usu1" $PROTO -prt_glid`
GLI_T1=`$ISSUER -k "trk1" $PROTO -prt_glid`
GLI_T2=`$ISSUER -k "trk2" $PROTO -prt_glid`

echo "GLID_USU1="$GLI_U1
echo "GLID_TRK1="$GLI_T1
echo "GLID_TRK2="$GLI_T2

$TRANSFER -k "supra" $PROTO -port "$PORT_S1" -is_supra &
$TRANSFER -k "usu1" $PROTO -port "$PORT_U1" -add_supra "$DOM_S"
$TRANSFER -k "usu2" $PROTO -port "$PORT_U2" -add_supra "$DOM_S"
$TRANSFER -k "trk1" $PROTO -port "$PORT_T1" -add_supra "$DOM_S"
$TRANSFER -k "trk2" $PROTO -port "$PORT_T2" -add_supra "$DOM_S"

echo "ADDED_ALL_USER_SUPRAS"

$TRANSFER -k "trk1" $PROTO -port "$PORT_T1" &
$TRANSFER -k "trk2" $PROTO -port "$PORT_T2" &

echo "STARTED_TRACKERS"

$ISSUER -k usu1 $PROTO -s -n 5z3 -m $CURR 
$ISSUER -k usu2 $PROTO -s -n 5z3 -m $CURR 
$ISSUER -k usu1 $PROTO -set_next_tracker $GLI_T1

echo "CHANGED_NEXT_TRACKER"

$ISSUER -k usu1 $PROTO -tat $GLI_U1
$ISSUER -k usu2 $PROTO -tat $GLI_U1
$ISSUER -k trk1 $PROTO -tat $GLI_U1

$TRANSFER -k usu1 $PROTO -chann -port "$PORT_U1" -r $GLI_T1

echo "UPDATED_TRACKER"

$TRANSFER -k "usu1" $PROTO -port "$PORT_U1" &
$TRANSFER -k "usu2" $PROTO -port "$PORT_U2" &

echo "USERS_STARTED"
